<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">
    <title>PlantControl</title>
    
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">
    <!--<![endif]-->
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/layouts/blog-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
            <link rel="stylesheet" href="css/layouts/blog.css">
        <!--<![endif]-->

    <script type="text/javascript">
        var dataToChartHum = [
                ['Medição', 'Solo', 'Ar'],
                ['1',0,0]
        ];

        function refreshChartHum(){
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChartHum);

            function drawChartHum() {
                var data = google.visualization.arrayToDataTable(dataToChartHum);

            var options = {
                title: 'Humidade',
                hAxis: {title: 'It',  titleTextStyle: {color: '#333'}},
                vAxis: {minValue: 0}
            };

                var chartHum = new google.visualization.AreaChart(document.getElementById('chartHum'));
                chartHum.draw(data, options);
          }
        }

        refreshChartHum();
        

        var dataToChartTemp = [
                ['Medição', 'Solo'],
                ['1',0]
        ];

        function refreshChartTemp(){
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChartTemp);

            function drawChartTemp() {
                var data = google.visualization.arrayToDataTable(dataToChartTemp);

            var options = {
                title: 'Temperatura',
                hAxis: {title: 'It',  titleTextStyle: {color: '#333'}},
                vAxis: {minValue: 0}
            };

                var chartTemp = new google.visualization.AreaChart(document.getElementById('chartTemp'));
                chartTemp.draw(data, options);
          }
        }


        refreshChartTemp();
          



          var dataToChartLight = [
                ['Medição', 'Ambiente'],
                ['1',0]
        ];

        function refreshChartLight(){
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChartLight);

            function drawChartLight() {
                var data = google.visualization.arrayToDataTable(dataToChartLight);

            var options = {
                title: 'Luz',
                hAxis: {title: 'It',  titleTextStyle: {color: '#333'}},
                vAxis: {minValue: 0}
            };

                var chartLight = new google.visualization.AreaChart(document.getElementById('chartLight'));
                chartLight.draw(data, options);
          }
        }


        refreshChartLight();


      var connection = new WebSocket('ws://localhost:8080');
        
        connection.onopen = function(){
            console.log('Connection open!');
            connection.send('I am the client. Hi!');
        }
        
        connection.onclose = function(){
            console.log('Connection closed!');
        }
        
        connection.onmessage = function(e){
            var serverMessage = e.data;
            var servermessageArray=serverMessage.split(":");
            var serverMessageType = servermessageArray[0];
            var serverMessageContent = servermessageArray[1];
            switch(serverMessageType){
                case 'hum':
                    var valueHumArray = serverMessageContent.split('~');
                    var value1 = valueHumArray[0];
                    var value2 = valueHumArray[1];
                    dataToChartHum.push([dataToChartHum.length,  value1, value2]);
                    refreshChartHum();
                    break;
                case 'temp':
                    dataToChartTemp.push([dataToChartTemp.length,  serverMessageContent]);
                    refreshChartTemp();
                    break;
                case 'light':
                    dataToChartLight.push([dataToChartLight.length,  serverMessageContent]);
                    refreshChartLight();
            }
        }

        function sendMessage(message){
            connection.send(message);
        }
    </script>
</head>
<body>







<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <h2 class="brand-title">PlantControl</h2>
            <h3 class="brand-tagline">Monitore e controle sua planta!</h3>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="http://purecss.io">Habilitar água</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="http://yuilibrary.com">Habilitar luz</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            <!-- A wrapper for all the blog posts -->
            <div class="posts">
                <h1 class="content-subhead">Dashboard</h1>

                <!-- A single blog post -->
                <section class="post">
                    <header class="post-header">
                        <img width="48" height="48" alt="Tilo Mitra&#x27;s avatar" class="post-avatar" src="img/common/suculenta.jpg">

                        <h2 class="post-title">Monitoramento em tempo real</h2>

                    </header>

                    <div class="post-description">
                        <div id="chartHum" style="width: 100%; height: 350px;"></div>
                        <hr/>
                        <div id="chartTemp" style="width: 100%; height: 350px;"></div>
                        <hr/>
                        <div id="chartLight" style="width: 100%; height: 350px;"></div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>




</body>
</html>
